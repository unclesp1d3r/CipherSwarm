---
inclusion: always
---

# CipherSwarm Development Pipeline Standards

## Core Principles

- **Conventional Commits:** All commits must follow conventional commit format (`feat:`, `fix:`, `docs:`, etc.)
- **Local/CI Parity:** All CI operations must be executable locally via `just` recipes
- **Release Please:** Automated versioning and changelog generation (no manual tagging)
- **Quality Gates:** Linting, testing, and security checks block merges and releases

## Python Development Standards

### Code Quality Tools

- **Formatting:** `ruff format` (enforced in CI)
- **Linting:** `ruff check` (comprehensive analysis)
- **Type Checking:** `mypy` for static type analysis
- **Security:** `bandit -r` for security scanning
- **Testing:** `pytest -q -n auto` with parallel execution
- **Coverage:** Target â‰¥80% coverage; upload to Codecov

### Required Configuration Files

```
pyproject.toml          # Python dependencies and tool config
.pre-commit-config.yaml # Pre-commit hooks
pytest.ini              # Test configuration
```

### Python-Specific Rules

- Line length: 119 characters (configured in `pyproject.toml`)
- Target version: Python 3.13+
- Use `uv` as package manager
- All async code must use proper async/await patterns
- Type hints required for all public functions

## Required Just Recipes

All projects must implement these `justfile` targets:

```justfile
# Development setup
setup:           # Install all dependencies
install-tools:   # Install development tools

# Quality gates (must match CI)
lint:           # Run all linters
fmt:            # Auto-format code
test:           # Run all tests
cover:          # Generate coverage reports
security:       # Run security analysis

# Build and release
build:          # Build artifacts
docs:           # Serve documentation locally
```

## CI/CD Workflow Requirements

### Required GitHub Actions Workflows

- `ci.yml`: PR and push checks (linting, testing, security)
- `release-please.yml`: Automated release proposals
- `release.yml`: Release artifact generation and publishing

### CI Job Requirements

1. **Pre-commit validation** - Run all configured hooks
2. **Linting and formatting** - `ruff check` and `ruff format --check`
3. **Testing** - `pytest` with coverage reporting
4. **Security scanning** - CodeQL, Bandit, dependency scanning
5. **Cross-platform testing** - macOS, Windows, Linux

## Security and Compliance

### Mandatory Security Controls

- **SAST:** GitHub CodeQL for static analysis
- **Dependency Scanning:** Automated vulnerability detection
- **License Scanning:** FOSSA integration for license compliance
- **SBOM Generation:** Software Bill of Materials for all releases
- **Artifact Signing:** Cosign keyless OIDC signing

### Security Best Practices

- No hardcoded secrets in code or configuration
- Use GitHub OIDC for authentication where possible
- All artifacts must include checksums and signatures
- Critical vulnerabilities block releases

## Documentation Standards

### Required Documentation

- `README.md` with installation and usage instructions
- `CHANGELOG.md` (auto-generated by Release Please)
- `mkdocs.yml` for documentation site configuration
- API documentation for all public interfaces

### Documentation Requirements

- MkDocs Material theme for consistency
- Auto-deployment on push to `main`
- Offline usage instructions for airgap environments
- Complete API reference documentation

## Dependency Management

### Renovate Configuration

- Weekly dependency updates (Monday mornings)
- Grouped updates by ecosystem
- Auto-merge for development tools (linters, formatters)
- Manual review for production dependencies

### Standard `renovate.json`

```json
{
  "extends": [
    "config:base"
  ],
  "schedule": [
    "before 9am on Monday"
  ],
  "groupName": "all dependencies",
  "packageRules": [
    {
      "matchDepTypes": [
        "devDependencies"
      ],
      "automerge": true
    }
  ]
}
```

## Testing Requirements

### Test Execution Standards

- Parallel test execution by default
- Coverage reporting to Codecov
- No flaky tests in main branch

### Test Organization

- Unit tests for core business logic
- Integration tests for API endpoints
- End-to-end tests for critical workflows
- Performance benchmarks where applicable

## Release Process

### Release Criteria

All releases must satisfy:

1. All CI checks pass
2. No critical security vulnerabilities
3. Coverage maintained or improved
4. Documentation updated for user-facing changes
5. Conventional commit format followed

### Artifact Requirements

- SHA256 checksums for all artifacts
- Cryptographic signatures via Cosign
- SBOM attached to releases
- SLSA Level 3 provenance attestation

## Exception Handling

Projects requiring deviations must document exceptions in `README.md`:

```markdown
## Exceptions

### [Rule Name]

-   **Rationale:** Technical justification
-   **Duration:** Time-bound end date
-   **Compensating Controls:** Alternative measures
```

## CipherSwarm-Specific Requirements

### Python Stack Compliance

- FastAPI framework with async/await patterns
- SQLAlchemy ORM with Alembic migrations
- Pydantic v2 for data validation
- Loguru for structured logging (no standard Python logging)
- Cashews for caching with Redis backend

### Code Organization

- Service layer pattern for business logic
- API endpoints delegate to services
- Pydantic schemas for all API input/output
- Type hints required throughout codebase

### Development Workflow

- Use `just` commands for all development tasks
- Docker Compose for local development environment
- Hot reload enabled for development
- Database migrations via Alembic
