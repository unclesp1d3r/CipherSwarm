{# Agent Benchmark Summary Fragment - rendered by /api/v1/web/agents/{id}/benchmarks #}
{% set has_benchmarks = benchmarks_by_hash_type|length > 0 %}
<div class="mt-4">
    <h4 class="text-md font-semibold mb-2">Benchmark Summary</h4>
    {% if not has_benchmarks %}
    <div class="text-gray-500 italic">No benchmark results available for this agent.</div>
    {% else %}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-2 text-left font-medium text-gray-700">Hash Mode</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-700">Name</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-700">Speed (h/s)</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-700">Devices</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
                {% for hash_type_id, benches in benchmarks_by_hash_type.items() %}
                {% set first = benches[0] %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2 font-mono">{{ first.hash_type_id }}</td>
                    <td class="px-4 py-2">
                        <span class="font-semibold">{{ first.hash_type_name }}</span>
                        {% if first.hash_type_description %}<br><span class="text-xs text-gray-500">{{
                            first.hash_type_description }}</span>{% endif %}
                    </td>
                    <td class="px-4 py-2">
                        {# Show total speed across all devices for this hash mode #}
                        {% set total_speed = benches | map(attribute='hash_speed') | sum %}
                        {{ total_speed | humanize_speed }}
                    </td>
                    <td class="px-4 py-2">
                        <button type="button" class="text-blue-600 hover:underline" onclick="
                  var row = this.closest('tr');
                  var next = row.nextElementSibling;
                  if (next && next.classList.contains('device-details')) {
                    next.classList.toggle('hidden');
                  }
                ">
                            View Devices ({{ benches|length }})
                        </button>
                    </td>
                </tr>
                <tr class="device-details hidden">
                    <td colspan="4" class="bg-gray-50 px-4 py-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                            {% for b in benches %}
                            <div class="border rounded p-2 bg-white flex flex-col">
                                <div class="font-mono text-xs text-gray-600">Device: {{ b.device }}</div>
                                <div class="text-xs text-gray-500">Speed: {{ b.hash_speed | humanize_speed }}</div>
                                <div class="text-xs text-gray-500">Runtime: {{ b.runtime }} ms</div>
                                <div class="text-xs text-gray-400">Benchmarked: {{ b.created_at }}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>

{# Removed humanize_speed macro; now using filter #}