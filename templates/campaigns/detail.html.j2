{% extends "base.html.j2" %}
{% block content %}
<div class="container mx-auto py-8 max-w-2xl">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">{{ campaign.name }}</h1>
            <div class="flex gap-2">
                <a href="/campaigns/{{ campaign.id }}/edit" class="text-yellow-600 hover:underline">Edit</a>
                <a href="/campaigns/{{ campaign.id }}/delete" class="text-red-600 hover:underline">Delete</a>
            </div>
        </div>
        <div class="mb-2">
            <span class="font-semibold">Description:</span> {{ campaign.description or "-" }}
        </div>
        <div class="mb-2">
            <span class="font-semibold">Private:</span> {{ "Yes" if campaign.private else "No" }}
        </div>
        <div class="mb-2">
            <span class="font-semibold">Notes:</span> {{ campaign.notes or "-" }}
        </div>
        <div class="text-sm text-gray-500 dark:text-gray-400 mt-4">
            <span>Created: {{ campaign.created_at if campaign.created_at else "-" }}</span> |
            <span>Updated: {{ campaign.updated_at if campaign.updated_at else "-" }}</span>
        </div>
        <div class="mt-6">
            <a href="/campaigns" class="text-blue-700 hover:underline">Back to Campaigns</a>
        </div>
    </div>
    <!-- Attack Summaries -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mt-8">
        <h2 class="text-xl font-semibold mb-4">Attacks</h2>
        {% if attacks %}
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th class="px-4 py-2">Name</th>
                        <th class="px-4 py-2">Type</th>
                        <th class="px-4 py-2">Length</th>
                        <th class="px-4 py-2">Settings</th>
                        <th class="px-4 py-2">Keyspace</th>
                        <th class="px-4 py-2">Complexity</th>
                        <th class="px-4 py-2">Comment</th>
                        <th class="px-4 py-2">Actions</th>
                    </tr>
                </thead>
                <tbody hx-get="/api/v1/web/campaigns/{{ campaign.id }}/attacks_table_body" hx-trigger="load"
                    hx-target="this" hx-swap="outerHTML">
                    {% for attack in attacks %}
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                        <td class="px-4 py-2 font-medium text-gray-900 dark:text-white">{{ attack.name }}</td>
                        <td class="px-4 py-2">{{ attack.type_label }}</td>
                        <td class="px-4 py-2">{{ attack.length if attack.length is not none else '-' }}</td>
                        <td class="px-4 py-2">{{ attack.settings_summary }}</td>
                        <td class="px-4 py-2">{{ attack.keyspace if attack.keyspace is not none else '-' }}</td>
                        <td class="px-4 py-2">{{ attack.complexity_score if attack.complexity_score is not none else '-'
                            }}</td>
                        <td class="px-4 py-2">{{ attack.comment or '-' }}</td>
                        <td class="px-4 py-2">
                            <div class="relative inline-block text-left">
                                <button id="menu-button-{{ attack.id }}" type="button"
                                    class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-2 py-1 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none"
                                    aria-expanded="true" aria-haspopup="true">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 6h16M4 12h16M4 18h16"></path>
                                    </svg>
                                </button>
                                <div class="origin-top-right absolute right-0 mt-2 w-36 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10 hidden group-hover:block"
                                    role="menu" aria-orientation="vertical"
                                    aria-labelledby="menu-button-{{ attack.id }}">
                                    <div class="py-1" role="none">
                                        <button hx-post="/api/v1/web/attacks/{{ attack.id }}/move"
                                            hx-vals='{"direction": "up"}' hx-target="closest tbody" hx-swap="outerHTML"
                                            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                            role="menuitem">Move Up</button>
                                        <button hx-post="/api/v1/web/attacks/{{ attack.id }}/move"
                                            hx-vals='{"direction": "down"}' hx-target="closest tbody"
                                            hx-swap="outerHTML"
                                            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                            role="menuitem">Move Down</button>
                                        <button hx-post="/api/v1/web/attacks/{{ attack.id }}/move"
                                            hx-vals='{"direction": "top"}' hx-target="closest tbody" hx-swap="outerHTML"
                                            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                            role="menuitem">Move to Top</button>
                                        <button hx-post="/api/v1/web/attacks/{{ attack.id }}/move"
                                            hx-vals='{"direction": "bottom"}' hx-target="closest tbody"
                                            hx-swap="outerHTML"
                                            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                            role="menuitem">Move to Bottom</button>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-gray-500">No attacks found for this campaign.</div>
        {% endif %}
    </div>
</div>
{% endblock %}